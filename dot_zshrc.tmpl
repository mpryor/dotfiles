export ZSH="$HOME/.oh-my-zsh"

ZSH_THEME="af-magic"
plugins=(
   git
)

{{- if eq .chezmoi.os "darwin" }}
BREW_PATH="/opt/homebrew/bin"
{{- else }}
BREW_PATH="/home/linuxbrew/.linuxbrew/bin"
{{- end }}

export EDITOR="nvim"

source $ZSH/oh-my-zsh.sh

set -o vi

alias k="kubectl"
alias gs="git status"
alias gg="git graph"
alias cm="chezmoi" # Think: config manager...
alias lg="lazygit"
alias reload="source ~/.zshrc"
alias vi="nvim"
alias vim="nvim"
alias ls="eza -alh --color=auto --icons=always --group-directories-first --git"

function checkout() {
   git checkout $(git branch -a | sed "s/remotes\/origin\///" | grep -v HEAD | grep -v "\*" | sort | uniq | fzf)
}

function cleanbranches() {
   git branch --merged | grep -v "\*" | grep -v main | grep -v master | xargs -n 1 git branch -d
}

function zz() {
   cd $(zoxide query -l --exclude $(pwd) $1 | sort -k 1 -n | awk '{print $1}' | fzf)
}

function y() {
   local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
   yazi "$@" --cwd-file="$tmp"
   IFS= read -r -d '' cwd <"$tmp"
   [ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
   rm -f -- "$tmp"
}

function ultimate-plumber() {
   BUFFER="$(up -c "${BUFFER}|")"
   CURSOR=$#BUFFER
}
zle -N ultimate-plumber
bindkey "^|" ultimate-plumber

zle -N y
bindkey "^y" y

function _load_functions() {
   local script_dir="$HOME/.zsh_functions"
   if [ -d "$script_dir" ]; then
      for script in "$script_dir"/*.zsh; do
         [ -r "$script" ] && source "$script"
      done
   fi
}

eval "$(${BREW_PATH}/brew shellenv)"
BREW_PREFIX=$(brew --prefix)
eval "$(zoxide init zsh)"
source <(fzf --zsh)
eval "$(atuin init zsh)"
source ${BREW_PREFIX}/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
source ${BREW_PREFIX}/share/zsh-autosuggestions/zsh-autosuggestions.zsh
eval "$(${BREW_PREFIX}/bin/mise activate zsh)"

_load_functions 
# vim:ft=bash
